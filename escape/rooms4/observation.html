<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê´€ì°°ì‹¤ - ê³¼ê±°ì˜ ê¸°ì–µ</title>
  <link rel="stylesheet" href="../style.css" />
  <script src="../inventory.js"></script>
  <script src="../journal.js"></script>
</head>
<body>
  <div class="game-layout">
    <!-- ì™¼ìª½ ê²Œì„ ì˜ì—­ -->
    <div class="game-area">
      <!-- ê·¸ë¦¼ ì˜ì—­ -->
      <div class="image-area">
        <img src="../IMG/ê´€ì°°ì‹¤.png" alt="ê´€ì°°ì‹¤" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
      </div>

      <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
      <div id="game-container">
        <div id="scene-text">
          ê´€ì°°ì‹¤ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ì»¤ë‹¤ë€ ìœ ë¦¬ì°½ ë„ˆë¨¸ì—ëŠ” ê³¼ê±°ì˜ ë‹¹ì‹ ì´ ëˆ„êµ°ê°€ë¥¼ ê³ ë¬¸í•˜ê±°ë‚˜ ë°©ê´€í•˜ê³  ìˆëŠ” ì¥ë©´ì´ ì¬ìƒë˜ê³  ìˆìŠµë‹ˆë‹¤. 
          ì´ ê¸°ì–µë“¤ì´ ì§„ì§œì¸ì§€, ì•„ë‹ˆë©´ ëˆ„êµ°ê°€ê°€ ì¡°ì‘í•œ ê²ƒì¸ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.
        </div>

        <div class="video-box">
          <h3 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ“¹ [ì˜ìƒ ì¬ìƒ]</h3>
          <p style="color: #e8f4fd; line-height: 1.6;">
            "í”¼ì‹¤í—˜ì²´ 017, ê°ì • ë°˜ì‘ ì–µì œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ì¬êµìœ¡ í•„ìš”. 
            ì‹¤í—˜ì²´ì˜ í­ë ¥ì„± ì¦ê°€ë¡œ ì¸í•´ ê²©ë¦¬ ì¡°ì¹˜ê°€ ì‹œê¸‰í•©ë‹ˆë‹¤."
          </p>
        </div>

        <div class="log">
          <h3 style="color: #4a9eff; margin-bottom: 15px;">ğŸ“‹ [ì‹¤í—˜ ê¸°ë¡]</h3>
          <div style="color: #e8f4fd; line-height: 1.6;">
            <p><strong>â–ª ì‹¤í—˜ì¼ì§€:</strong> 017ì€ ê°ì • ì–µì œ ì‹¤íŒ¨ ì‹œ í­ë ¥ì„±ì´ ê¸‰ì¦í•¨.</p>
            <p><strong>â–ª ì—°êµ¬ì ì½”ë©˜íŠ¸:</strong> "ì´ê±´ ë¬´ì–¸ê°€ ì˜ëª»ëì–´... ìš°ë¦° ê´´ë¬¼ì„ ë§Œë“  ê±¸ê¹Œ?"</p>
            <p><strong>â–ª ë³´ì•ˆ ë“±ê¸‰:</strong> ìµœìƒìœ„ ë³´ì•ˆ ì‹œì„¤ë¡œ ê²©ë¦¬ í•„ìš”</p>
          </div>
        </div>

        <div class="choice-section">
          <h2 style="color: #e8f4fd; margin: 30px 0 20px 0; text-align: center;">ğŸ’­ ë‹¹ì‹ ì˜ ë°˜ì‘ì€?</h2>
          <div id="options" class="choices">
            <button onclick="selectPath('empathy')" class="game-button empathy">
              <span class="button-icon">ğŸ’™</span>
              <span class="button-text">"ê·¸ë“¤ì„ ì´í•´í•  ìˆ˜ ìˆì–´â€¦ ë‚œ ê·¸ì € ì´ìš©ë‹¹í•œ ì¡´ì¬ì¼ ë¿ì´ì•¼."</span>
            </button>
            <button onclick="selectPath('anger')" class="game-button anger">
              <span class="button-icon">ğŸ’¢</span>
              <span class="button-text">"ì´ê±´ ëˆ„êµ°ê°€ì˜ ì˜ëª»ì´ì•¼â€¦ ë°˜ë“œì‹œ ë˜ê°šì•„ì£¼ê² ì–´."</span>
            </button>
            <button onclick="selectPath('despair')" class="game-button despair">
              <span class="button-icon">ğŸ˜”</span>
              <span class="button-text">"â€¦ë‚œ ê²°êµ­ ê´´ë¬¼ì´ì—ˆì–´. ëŒì´í‚¬ ìˆ˜ ì—†ì–´."</span>
            </button>
          </div>
        </div>

        <div class="reaction" id="reactionText"></div>
        <div style="margin-top: 20px; text-align: center;">
          <button id="continueBtn" style="display:none;" onclick="goNext()" class="game-button primary">
            <span class="button-icon">â¡ï¸</span>
            <span class="button-text">ê³„ì†</span>
          </button>
        </div>

        <div id="message" class="message-display"></div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
      <!-- ì¸ë²¤í† ë¦¬ì™€ ì¼ì§€ê°€ ì—¬ê¸°ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
  </div>

  <style>
    .game-button {
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.2) 0%, rgba(41, 128, 185, 0.2) 100%);
      border: 2px solid rgba(74, 158, 255, 0.4);
      border-radius: 12px;
      padding: 16px 20px;
      color: #e8f4fd;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s ease;
      margin: 8px 0;
      width: 100%;
      text-align: left;
    }

    .game-button:hover {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.3) 0%, rgba(41, 128, 185, 0.3) 100%);
      border-color: rgba(74, 158, 255, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 158, 255, 0.3);
    }

    .game-button.primary {
      background: linear-gradient(135deg, #4a9eff 0%, #2980b9 100%);
      border-color: #4a9eff;
      color: white;
      text-align: center;
      justify-content: center;
      width: auto;
      min-width: 150px;
    }

    .game-button.primary:hover {
      background: linear-gradient(135deg, #5ba9ff 0%, #3a90ca 100%);
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(74, 158, 255, 0.4);
    }

    .game-button.empathy {
      background: linear-gradient(135deg, rgba(100, 181, 246, 0.2) 0%, rgba(33, 150, 243, 0.2) 100%);
      border-color: rgba(100, 181, 246, 0.4);
    }

    .game-button.empathy:hover {
      background: linear-gradient(135deg, rgba(100, 181, 246, 0.3) 0%, rgba(33, 150, 243, 0.3) 100%);
      border-color: rgba(100, 181, 246, 0.6);
    }

    .game-button.anger {
      background: linear-gradient(135deg, rgba(239, 83, 80, 0.2) 0%, rgba(211, 47, 47, 0.2) 100%);
      border-color: rgba(239, 83, 80, 0.4);
    }

    .game-button.anger:hover {
      background: linear-gradient(135deg, rgba(239, 83, 80, 0.3) 0%, rgba(211, 47, 47, 0.3) 100%);
      border-color: rgba(239, 83, 80, 0.6);
    }

    .game-button.despair {
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.2) 0%, rgba(123, 31, 162, 0.2) 100%);
      border-color: rgba(156, 39, 176, 0.4);
    }

    .game-button.despair:hover {
      background: linear-gradient(135deg, rgba(156, 39, 176, 0.3) 0%, rgba(123, 31, 162, 0.3) 100%);
      border-color: rgba(156, 39, 176, 0.6);
    }

    .button-icon {
      font-size: 18px;
      min-width: 24px;
    }

    .button-text {
      flex: 1;
    }

    .video-box {
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(220, 53, 69, 0.1) 100%);
      border: 2px solid rgba(255, 107, 107, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      backdrop-filter: blur(10px);
    }

    .log {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 2px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      backdrop-filter: blur(10px);
    }

    .choice-section {
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.9) 0%, rgba(22, 33, 62, 0.9) 100%);
      border: 2px solid rgba(74, 158, 255, 0.4);
      border-radius: 20px;
      padding: 30px;
      margin: 20px 0;
      backdrop-filter: blur(15px);
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .reaction {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      color: #4a9eff;
      font-weight: 600;
      min-height: 20px;
      backdrop-filter: blur(10px);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .message-display {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      color: #4a9eff;
      font-weight: 600;
      min-height: 20px;
      backdrop-filter: blur(10px);
    }

    #scene-text {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      color: #e8f4fd;
      font-size: 16px;
      line-height: 1.6;
      backdrop-filter: blur(10px);
    }

    /* ê°ì • ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
    body.empathy .reaction {
      color: #64b5f6;
      border-color: rgba(100, 181, 246, 0.3);
    }

    body.anger .reaction {
      color: #ef5350;
      border-color: rgba(239, 83, 80, 0.3);
    }

    body.despair .reaction {
      color: #9c27b0;
      border-color: rgba(156, 39, 176, 0.3);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-10px); }
      40%, 80% { transform: translateX(10px); }
    }

    .shake {
      animation: shake 0.5s;
    }
  </style>

  <script>
    function resetObservation() {
      const body = document.body;
      const reaction = document.getElementById('reactionText');
      body.classList.remove('empathy', 'anger', 'despair', 'shake');
      if (reaction) {
        reaction.textContent = '';
        reaction.style.opacity = 0;
      }
      const c = document.getElementById('continueBtn');
      if (c) c.style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', () => {
      resetObservation();
    });

    // BFCacheë¡œ ë³µê·€ ì‹œì—ë„ ì¤‘ë¦½ ìƒíƒœë¡œ ë³´ì¥
    window.addEventListener('pageshow', (ev) => {
      if (ev.persisted) resetObservation();
    });

    function applyChoiceVisual(choice) {
      const body = document.body;
      const reaction = document.getElementById("reactionText");
      localStorage.setItem("mentalState", choice);
      body.classList.add(choice);
      body.classList.add('shake');
      
      let message = "";
      if (choice === "empathy") {
        message = "ë‹¹ì‹ ì€ ê·¸ë“¤ì˜ ê³ í†µì„ ì´í•´í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê²ƒì´ ì •ë‹¹í™”ë  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.";
      } else if (choice === "anger") {
        message = "ë¶„ë…¸ê°€ ê°€ë“í•©ë‹ˆë‹¤. ëˆ„êµ°ê°€ê°€ ì´ ëª¨ë“  ì¼ì˜ ì±…ì„ì„ ì ¸ì•¼ í•©ë‹ˆë‹¤.";
      } else if (choice === "despair") {
        message = "ì ˆë§ì— ë¹ ì§‘ë‹ˆë‹¤. ê³¼ê±°ì˜ ì˜ëª»ì„ ë˜ëŒë¦´ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ ê´´ë¡­ìŠµë‹ˆë‹¤.";
      }
      
      reaction.textContent = message;
      reaction.style.opacity = 1;
      
      setTimeout(() => {
        const continueBtn = document.getElementById('continueBtn');
        if (continueBtn) continueBtn.style.display = 'inline-block';
      }, 2000);
    }

    function selectPath(choice) {
      applyChoiceVisual(choice);
      addJournalEntry(`ê´€ì°°ì‹¤ì—ì„œ ${choice === 'empathy' ? 'ê³µê°' : choice === 'anger' ? 'ë¶„ë…¸' : 'ì ˆë§'}ì˜ ì„ íƒì„ í–ˆìŠµë‹ˆë‹¤.`, 'choice');
      
      // ì‹¤í—˜ìì˜ ì—´ì‡ ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ê¸°íšŒ (íŠ¹íˆ ë¶„ë…¸ ìƒíƒœì¼ ë•Œ)
      if (choice === 'anger' && Math.random() < 0.6 && !hasInImportantInventory('ì‹¤í—˜ìì˜ ì—´ì‡ ')) {
        setTimeout(() => {
          const reaction = document.getElementById('reactionText');
          reaction.innerHTML += '<br><br><span style="color: #ffc107;">ğŸ’¡ ë¶„ë…¸ì˜ ê°ì •ì´ ë‹¹ì‹ ì—ê²Œ ì‹¤í—˜ìë“¤ì˜ ì—´ì‡ ë¥¼ ì°¾ëŠ” í˜ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤!</span>';
          addToImportantInventory('ì‹¤í—˜ìì˜ ì—´ì‡ ', 1);
          addJournalEntry('ë¶„ë…¸ì˜ ê°ì •ì´ ì‹¤í—˜ìë“¤ì˜ ë§ˆìŠ¤í„° ì—´ì‡ ë¥¼ ì°¾ëŠ” í˜ì„ ì£¼ì—ˆë‹¤. ì´ ì—´ì‡ ë¡œ ì‹¤í—˜ ì‹œì„¤ì˜ ëª¨ë“  ë¬¸ì„ ì—´ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.', 'clue');
        }, 3000);
      }
    }

    function goNext() {
      window.location.href = '../rooms5/isolation.html';
    }
  </script>
</body>
</html>
