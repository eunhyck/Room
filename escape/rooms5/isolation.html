<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê²©ë¦¬ì‹¤ - ê¸°ì–µì˜ ë³µì›</title>
  <link rel="stylesheet" href="../style.css" />
  <script src="../inventory.js"></script>
  <script src="../journal.js"></script>
</head>
<body>
  <div class="game-layout">
    <!-- ì™¼ìª½ ê²Œì„ ì˜ì—­ -->
    <div class="game-area">
      <!-- ê·¸ë¦¼ ì˜ì—­ -->
      <div class="image-area">
        <img src="../IMG/ê²©ë¦¬ì‹¤.png" alt="ê²©ë¦¬ì‹¤" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
      </div>

      <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
      <div id="game-container">
        <div id="scene-text">
          ê¹Šì€ ì–´ë‘  ì†, ë‹¹ì‹ ì€ ë‚¯ì„  ê¸°ê³„ì— ë¬¶ì—¬ ìˆìŠµë‹ˆë‹¤. ê¸°ì–µì˜ ì¡°ê°ì´ ì¡°ì‘ë˜ê³ , ë‹¹ì‹ ì˜ ì˜ì§€ëŠ” í”ë“¤ë¦½ë‹ˆë‹¤. 
          ì´ê³³ì€ ì‹¤í—˜ì²´ë“¤ì„ ê²©ë¦¬í•˜ê³  ê¸°ì–µì„ ì¡°ì‘í•˜ëŠ” ê³³ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
        </div>
        
        <div class="puzzle">
          <h3 style="color: #4a9eff; margin-bottom: 20px;">ğŸ§© ê¸°ì–µ ì¡°ê° í¼ì¦</h3>
          <p style="margin-bottom: 20px; color: #e8f4fd; line-height: 1.6;">
            ì•„ë˜ ë‹¨ì–´ë“¤ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ í´ë¦­í•˜ì—¬ ê¸°ì–µì„ ë³µì›í•˜ì„¸ìš”. 
            ê¸°ê³„ê°€ ë‹¹ì‹ ì˜ ê¸°ì–µì„ ì¡°ì‘í•˜ë ¤ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
          </p>
          
          <!-- íŒíŠ¸ ì„¹ì…˜ ì¶”ê°€ -->
          <div class="hint-section">
            <button onclick="toggleHint()" class="hint-button">
              <span class="button-icon">ğŸ’¡</span>
              <span class="button-text">íŒíŠ¸ ë³´ê¸°</span>
            </button>
            <div id="hint-content" class="hint-content" style="display: none;">
              <h4 style="color: #4a9eff; margin-bottom: 15px;">ğŸ” ê¸°ì–µ ë³µì› ê°€ì´ë“œ</h4>
              <div class="hint-text">
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>1ë‹¨ê³„:</strong> "ê¸°ì–µ"ë¶€í„° ì‹œì‘í•˜ì„¸ìš”</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>2ë‹¨ê³„:</strong> "ì¡°ì‘"ì´ ë‹¤ìŒì…ë‹ˆë‹¤</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>3ë‹¨ê³„:</strong> "ì‹¤í—˜"ì´ ì´ì–´ì§‘ë‹ˆë‹¤</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>4ë‹¨ê³„:</strong> "íƒˆì¶œ"ì„ ìƒê°í•˜ì„¸ìš”</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>5ë‹¨ê³„:</strong> "ì§„ì‹¤"ì„ ì°¾ìœ¼ì„¸ìš”</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>6ë‹¨ê³„:</strong> "ê±°ì§“"ì„ êµ¬ë³„í•˜ì„¸ìš”</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>7ë‹¨ê³„:</strong> "í¬ìƒ"ì„ ê¸°ì–µí•˜ì„¸ìš”</p>
                <p style="color: #e8f4fd; margin-bottom: 10px;"><strong>8ë‹¨ê³„:</strong> "ë³µìˆ˜"ë¡œ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”</p>
              </div>
              <div class="hint-progress">
                <p style="color: #4a9eff; font-weight: 600;">ì§„í–‰ ìƒí™©: <span id="progress-text">0/8</span></p>
                <div class="progress-bar">
                  <div id="progress-fill" class="progress-fill"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div id="word-list" class="word-container"></div>
        </div>

        <div class="message" id="result"></div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
      <!-- ì¸ë²¤í† ë¦¬ì™€ ì¼ì§€ê°€ ì—¬ê¸°ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>
  </div>

  <style>
    .puzzle {
      background: linear-gradient(145deg, rgba(26, 26, 46, 0.9) 0%, rgba(22, 33, 62, 0.9) 100%);
      border: 2px solid rgba(74, 158, 255, 0.4);
      border-radius: 20px;
      padding: 30px;
      margin: 20px 0;
      backdrop-filter: blur(15px);
    }

    .hint-section {
      margin-bottom: 25px;
      text-align: center;
    }

    .hint-button {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 152, 0, 0.2) 100%);
      border: 2px solid rgba(255, 193, 7, 0.4);
      border-radius: 12px;
      padding: 12px 20px;
      color: #ffc107;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .hint-button:hover {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.3) 0%, rgba(255, 152, 0, 0.3) 100%);
      border-color: rgba(255, 193, 7, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
    }

    .hint-content {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%);
      border: 1px solid rgba(255, 193, 7, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin-top: 15px;
      text-align: left;
    }

    .hint-text {
      margin-bottom: 20px;
    }

    .hint-progress {
      text-align: center;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(74, 158, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4a9eff 0%, #4CAF50 100%);
      width: 0%;
      transition: width 0.5s ease;
    }

    .word-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .word-button {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.2) 0%, rgba(41, 128, 185, 0.2) 100%);
      border: 2px solid rgba(74, 158, 255, 0.4);
      border-radius: 12px;
      padding: 15px;
      color: #e8f4fd;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .word-button:hover {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.3) 0%, rgba(41, 128, 185, 0.3) 100%);
      border-color: rgba(74, 158, 255, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 158, 255, 0.3);
    }

    .word-button.clicked {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.3) 0%, rgba(56, 142, 60, 0.3) 100%);
      border-color: rgba(76, 175, 80, 0.6);
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .word-button.clicked::after {
      content: 'âœ“';
      position: absolute;
      top: 5px;
      right: 8px;
      color: #4CAF50;
      font-weight: bold;
      font-size: 16px;
    }

    .word-button.disabled {
      background: linear-gradient(135deg, rgba(108, 117, 125, 0.2) 0%, rgba(73, 80, 87, 0.2) 100%);
      border-color: rgba(108, 117, 125, 0.4);
      cursor: default;
      opacity: 0.6;
    }

    .message {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      color: #4a9eff;
      font-weight: 600;
      min-height: 40px;
      backdrop-filter: blur(10px);
    }

    #scene-text {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      color: #e8f4fd;
      font-size: 16px;
      line-height: 1.6;
      backdrop-filter: blur(10px);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-10px); }
      40%, 80% { transform: translateX(10px); }
    }

    .shake {
      animation: shake 0.5s;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 1.5s forwards;
      opacity: 0;
    }

    .success-message {
      color: #4CAF50 !important;
      border-color: rgba(76, 175, 80, 0.3) !important;
    }

    .error-message {
      color: #f44336 !important;
      border-color: rgba(244, 67, 54, 0.3) !important;
    }

    .hint-message {
      color: #ffc107 !important;
      border-color: rgba(255, 193, 7, 0.3) !important;
    }
  </style>

  <script>
    const words = ['ê¸°ì–µ', 'ì¡°ì‘', 'ì‹¤í—˜', 'íƒˆì¶œ', 'ì§„ì‹¤', 'ê±°ì§“', 'í¬ìƒ', 'ë³µìˆ˜'];
    const correctOrder = ['ê¸°ì–µ', 'ì¡°ì‘', 'ì‹¤í—˜', 'íƒˆì¶œ', 'ì§„ì‹¤', 'ê±°ì§“', 'í¬ìƒ', 'ë³µìˆ˜'];
    let clickedWords = [];
    let isCompleted = false;
    let hintShown = false;

    function toggleHint() {
      const hintContent = document.getElementById('hint-content');
      const hintButton = document.querySelector('.hint-button');
      
      if (hintContent.style.display === 'none') {
        hintContent.style.display = 'block';
        hintButton.innerHTML = '<span class="button-icon">ğŸ‘ï¸</span><span class="button-text">íŒíŠ¸ ìˆ¨ê¸°ê¸°</span>';
        hintShown = true;
        addJournalEntry('ê¸°ì–µ í¼ì¦ì˜ íŒíŠ¸ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.', 'observation');
      } else {
        hintContent.style.display = 'none';
        hintButton.innerHTML = '<span class="button-icon">ğŸ’¡</span><span class="button-text">íŒíŠ¸ ë³´ê¸°</span>';
        hintShown = false;
      }
    }

    function updateProgress() {
      const progressText = document.getElementById('progress-text');
      const progressFill = document.getElementById('progress-fill');
      const progress = (clickedWords.length / correctOrder.length) * 100;
      
      progressText.textContent = `${clickedWords.length}/${correctOrder.length}`;
      progressFill.style.width = `${progress}%`;
    }

    function renderWords() {
      const wordList = document.getElementById('word-list');
      wordList.innerHTML = '';
      
      // ë‹¨ì–´ë“¤ì„ ëœë¤í•˜ê²Œ ì„ê¸°
      const shuffledWords = [...words].sort(() => Math.random() - 0.5);
      
      shuffledWords.forEach(word => {
        const button = document.createElement('button');
        button.className = 'word-button fade-in';
        button.textContent = word;
        button.onclick = () => clickWord(word, button);
        wordList.appendChild(button);
      });
    }

    function clickWord(word, button) {
      if (isCompleted || button.classList.contains('clicked')) return;
      
      clickedWords.push(word);
      button.classList.add('clicked');
      button.disabled = true;
      
      // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
      updateProgress();
      
      // í´ë¦­ëœ ìˆœì„œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
      const isCorrect = clickedWords.every((w, i) => w === correctOrder[i]);
      
      if (isCorrect && clickedWords.length === correctOrder.length) {
        // ì„±ê³µ
        isCompleted = true;
        showResult('ğŸ‰ ê¸°ì–µì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ ë°©ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...', 'success');
        addJournalEntry('ê²©ë¦¬ì‹¤ì—ì„œ ê¸°ì–µ ì¡°ê° í¼ì¦ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤. ëª¨ë“  ê¸°ì–µì´ ì„ ëª…í•´ì¡ŒìŠµë‹ˆë‹¤.', 'clue');
        
        setTimeout(() => {
          window.location.href = '../rooms6/containment.html';
        }, 3000);
      } else if (clickedWords.length === correctOrder.length) {
        // ì‹¤íŒ¨
        showResult('âŒ ê¸°ì–µ ìˆœì„œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. íŒíŠ¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
        addJournalEntry('ê¸°ì–µ ì¡°ê° í¼ì¦ì„ í‹€ë ¸ìŠµë‹ˆë‹¤. ìˆœì„œë¥¼ ë‹¤ì‹œ ìƒê°í•´ë´ì•¼ê² ìŠµë‹ˆë‹¤.', 'observation');
        
        setTimeout(() => {
          resetPuzzle();
        }, 2000);
      } else {
        // ì§„í–‰ ì¤‘
        if (isCorrect) {
          showResult(`âœ… ${word} ì„ íƒë¨ (${clickedWords.length}/${correctOrder.length}) - ì˜¬ë°”ë¥¸ ìˆœì„œì…ë‹ˆë‹¤!`, 'success');
        } else {
          showResult(`âš ï¸ ${word} ì„ íƒë¨ (${clickedWords.length}/${correctOrder.length}) - ìˆœì„œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. íŒíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.`, 'hint-message');
          // í‹€ë¦° ìˆœì„œì¼ ë•Œ íŒíŠ¸ ìë™ í‘œì‹œ
          if (!hintShown) {
            setTimeout(() => {
              toggleHint();
            }, 1000);
          }
        }
      }
    }

    function showResult(message, type) {
      const result = document.getElementById('result');
      result.textContent = message;
      result.className = `message ${type === 'success' ? 'success-message' : type === 'error' ? 'error-message' : 'hint-message'}`;
    }

    function resetPuzzle() {
      clickedWords = [];
      isCompleted = false;
      hintShown = false;
      renderWords();
      showResult('', '');
      updateProgress();
      
      // íŒíŠ¸ ìˆ¨ê¸°ê¸°
      const hintContent = document.getElementById('hint-content');
      const hintButton = document.querySelector('.hint-button');
      hintContent.style.display = 'none';
      hintButton.innerHTML = '<span class="button-icon">ğŸ’¡</span><span class="button-text">íŒíŠ¸ ë³´ê¸°</span>';
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ì¼ë°˜ ì•„ì´í…œë§Œ ì´ˆê¸°í™” (ì¤‘ìš” ì•„ì´í…œì€ ìœ ì§€)
      if (window.inventory) {
        window.inventory.clearNormalInventory();
      }
      
      renderWords();
      updateProgress();
      addJournalEntry('ê²©ë¦¬ì‹¤ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ê¸°ì–µ ì¡°ì‘ ê¸°ê³„ê°€ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.', 'observation');
    });
  </script>
</body>
</html>
